# Phase 03: 模块分级与优先级排序

> **前置条件**：Phase 02 完成（工程分析已完成）  
> **目标**：建立模块处理优先级队列，最大化收益并降低风险

---

## 进入条件

- Phase 02 验收通过
- 或从 [Workflow.md](../Workflow.md.md) 决策树判断需要执行此阶段

---

## 执行指令

**加载 Skill**：阅读并执行 → [Skill 03: 模块分级与优先级](../skills/skill-03-prioritization.md)

---

## 阶段验收标准

在 Skill 03 完成后，验证以下条件全部满足：

### 必须满足

- [ ] **Backlog 文档存在**
  ```bash
  cat docs/testing/backlog.md
  # 应包含模块列表和优先级
  ```

- [ ] **条目数量**：至少 10 个可执行切片
  ```
  队列条目数 >= 10（或覆盖所有关键模块）
  ```

- [ ] **每个条目包含**：
  - [ ] 模块名称
  - [ ] 预估评估状态（S1-S4）
  - [ ] 测试策略（L1/L2/L3）
  - [ ] 优先级排序依据

### 质量检查

- [ ] 高优先级模块排在前面
- [ ] 风险过高的模块未排在最前（避免开局失败）
- [ ] 有"快速胜利"模块（S1/S2 且低风险）

---

## 阶段产出物

| 产出 | 路径 | 说明 |
|------|------|------|
| 测试待办 | `docs/testing/backlog.md` | 优先级队列 |

---

## 优先级评分模型

### 评分维度

```
总分 = 收益分 × 可测性分 / 风险分
```

#### 收益分（1-5）

| 因素 | 高分(5) | 低分(1) |
|------|---------|---------|
| 改动频率 | 经常修改 | 几乎不动 |
| 业务重要性 | 核心功能 | 边缘功能 |
| Bug 历史 | 频繁出问题 | 稳定 |
| 依赖者数量 | 被多处依赖 | 独立模块 |

#### 可测性分（1-5）

| 因素 | 高分(5) | 低分(1) |
|------|---------|---------|
| 依赖复杂度 | 无外部依赖 | 复杂依赖链 |
| 边界清晰度 | 接口明确 | 边界模糊 |
| 确定性 | 纯函数 | 高并发/随机 |
| 代码质量 | 结构清晰 | 意大利面 |

#### 风险分（1-5，越低越好）

| 因素 | 高分(5) | 低分(1) |
|------|---------|---------|
| 耦合度 | 全局状态 | 完全解耦 |
| 并发复杂度 | 多线程共享 | 单线程 |
| 硬件依赖 | 需要特定硬件 | 纯软件 |
| 重构难度 | 需要大改 | 小调整 |

### 排序策略

| 批次 | 目标 | 选择标准 |
|------|------|----------|
| 第一批（打样） | 快速建立信心和经验 | 3-5 个"高收益 + 高可测性 + 低风险"的模块 |
| 第二批（核心） | 覆盖核心模块 | 高收益的核心模块，可能需要重构但价值高 |
| 第三批（长尾） | 补充覆盖 | 收益较低或风险较高的模块，根据资源情况决定 |

---

## Backlog 条目格式

使用 [Backlog 条目模板](../templates/backlog-entry.md) 格式。

最小示例：

```markdown
## 优先级队列

### P1（高优先级）

| 模块 | 预估状态 | 策略 | 评分 | 备注 |
|------|----------|------|------|------|
| util/string | S1 | L1 | 25 | 快速胜利 |
| core/parser | S2 | L1+L2 | 20 | 核心模块 |

### P2（中优先级）

| 模块 | 预估状态 | 策略 | 评分 | 备注 |
|------|----------|------|------|------|
| io/network | S3 | L2 | 12 | 需要解耦 |

### P3（低优先级）

| 模块 | 预估状态 | 策略 | 评分 | 备注 |
|------|----------|------|------|------|
| driver/hw | S3 | L3 | 5 | 硬件依赖 |
```

---

## 完成后跳转

| 验收结果 | 下一步 |
|----------|--------|
| 通过 | 进入 [Phase 04: 迭代循环](04-iteration.md) |
| 未通过 | 返回 Skill 03 补充评估 |

---

## 时间预估

| 工程规模 | 预估时间 |
|----------|----------|
| 小型（<10 模块） | 0.5-1 小时 |
| 中型（10-50 模块） | 1-2 小时 |
| 大型（>50 模块） | 2-4 小时 |

---

**执行**：立即加载 [Skill 03](../skills/skill-03-prioritization.md) 开始执行
