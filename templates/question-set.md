# 人工问询模板

> **用途**：结构化向用户提问，最小化打扰，一次问清  
> **触发**：Skill 10 人工介入时使用

---

## 使用说明

1. 收集不确定点
2. 使用下方模板组织问题
3. 一次性提交给用户
4. 记录答案并转化为测试/文档

---

## 问询文档模板

```markdown
# 模块 <module_name> 业务澄清请求

> 生成日期: YYYY-MM-DD
> 问题数量: N
> 预计回答时间: 5-10 分钟

---

## 背景

我们正在为 **<module_name>** 模块建立单元测试体系。在代码分析过程中遇到以下不确定点，需要您的判断才能继续。

**请直接在选项前的 [ ] 中标记您的选择**，或在"其他"处填写补充说明。

---

## 问题 1: <简短标题>

### 代码位置
`<file_path>:<line_number>`

```<language>
// 相关代码片段
<code_snippet>
```

### 当前行为
<描述当前代码做了什么>

### 不确定点
<具体说明不确定的是什么>

### 选项

- [ ] **A**: <选项 A 描述>
  - 理由: <为什么可能选 A>
  - 影响: <选 A 后测试怎么写>

- [ ] **B**: <选项 B 描述>
  - 理由: <为什么可能选 B>
  - 影响: <选 B 后测试怎么写>

- [ ] **C**: 其他 → 请说明: ________________

### 风险提示
如果判断错误：<可能导致的问题>

---

## 问题 2: <简短标题>

### 代码位置
`<file_path>:<line_number>`

```<language>
<code_snippet>
```

### 当前行为
<描述>

### 不确定点
<说明>

### 选项

- [ ] **A**: <描述>
- [ ] **B**: <描述>
- [ ] **C**: 其他 → 请说明: ________________

### 风险提示
<说明>

---

## 问题 3: ...

（继续添加问题，建议不超过 5 个）

---

## 提交方式

回答完成后，请通过以下任一方式反馈：

1. 直接在本文档中标记选项并回复
2. 口头告知选择（我会记录）
3. 在 `docs/decisions/<module>_clarifications.md` 中记录

---

## 补充信息（可选）

如果上述问题涉及的背景信息对您有帮助：

### 相关文件
- `<file1>`: <说明>
- `<file2>`: <说明>

### 相关历史
- <commit/PR/issue 链接>

---

感谢您的时间！您的回答将帮助我们建立准确的测试覆盖。
```

---

## 问题分类模板

### 边界条件问题

```markdown
## 问题: <函数名> 的边界处理

### 代码位置
`src/utils/calc.cpp:45`

```cpp
int calculate(int value) {
    if (value < 0) {
        return ???;  // 不确定应该返回什么
    }
    return value * 2;
}
```

### 不确定点
当输入为负数时，应该怎么处理？

### 选项
- [ ] **A**: 返回 0（截断到有效范围）
- [ ] **B**: 返回 -1（错误标记）
- [ ] **C**: 抛出异常
- [ ] **D**: 其他: ________________
```

### 错误处理问题

```markdown
## 问题: 网络错误的处理策略

### 代码位置
`src/client/http.cpp:120`

```cpp
Response fetch(const string& url) {
    auto resp = doRequest(url);
    if (!resp.ok()) {
        // 当前: 静默返回空响应
        return Response{};
    }
    return resp;
}
```

### 不确定点
网络错误时应该怎么处理？

### 选项
- [ ] **A**: 保持现状（返回空响应）
- [ ] **B**: 抛出异常
- [ ] **C**: 返回错误码
- [ ] **D**: 重试后失败再报错
```

### 业务规则问题

```markdown
## 问题: 订单金额计算规则

### 代码位置
`src/order/calculator.cpp:80`

```cpp
double calculateTotal(const Order& order) {
    double total = order.subtotal;
    if (order.hasDiscount) {
        total *= 0.9;  // 90% 折扣
    }
    if (order.hasCoupon) {
        total -= 10;   // 减 10 元
    }
    return total;
}
```

### 不确定点
折扣和优惠券的应用顺序是否正确？（先乘后减 vs 先减后乘）

### 选项
- [ ] **A**: 先折扣后优惠券（当前逻辑）
- [ ] **B**: 先优惠券后折扣
- [ ] **C**: 只能用其中一个
- [ ] **D**: 其他规则: ________________
```

### 兼容性问题

```markdown
## 问题: 旧版本数据格式支持

### 代码位置
`src/data/parser.cpp:30`

```cpp
Data parse(const string& input) {
    // 新格式: JSON
    // 旧格式: XML (代码中有但注释了)
}
```

### 不确定点
是否还需要支持旧的 XML 格式？

### 选项
- [ ] **A**: 需要同时支持新旧格式
- [ ] **B**: 只需要支持新格式（可以删除旧代码）
- [ ] **C**: 需要迁移工具但运行时不支持
```

---

## 答案记录模板

```markdown
# <module_name> 业务澄清记录

> 问询日期: YYYY-MM-DD
> 回答日期: YYYY-MM-DD
> 回答者: <name/role>

---

## 问题 1: <标题>

**问题摘要**: <一句话描述>

**选择**: <选项字母>

**补充说明**: <如有>

**转化动作**:
- [ ] 测试用例: `test_<function>_when_<condition>_then_<result>`
- [ ] 文档更新: 在 `<file>` 添加说明
- [ ] 代码注释: 在 `<location>` 添加解释

---

## 问题 2: <标题>

...

---

## 总结

| 问题 | 选择 | 影响 |
|------|------|------|
| Q1: <简述> | A | <影响说明> |
| Q2: <简述> | B | <影响说明> |

---

## 后续动作

- [ ] 根据 Q1 答案添加边界测试
- [ ] 根据 Q2 答案更新错误处理测试
- [ ] 在模块卡片中记录业务规则
```

---

## 问询质量检查清单

```markdown
提交问询前检查：

- [ ] 问题数量 ≤ 5
- [ ] 每个问题有代码引用
- [ ] 每个问题有明确选项
- [ ] 每个问题说明了风险
- [ ] 不包含可以通过代码分析确定的问题
- [ ] 预计用户能在 10 分钟内回答完
```
