# 分解审视约定

> **阅读时机**：Phase 02 完成后、Skill 02 Task 5 执行时。

---

## 目的

在完成一轮模块识别与报告撰写后，检查当前模块划分是否稳定、合理。若不通过，则产出变更列表并按回退规则回到 Phase 01 或 Phase 02，形成「分解 → 分析 → 审视 → 必要时重做」的迭代闭环。

---

## 审视维度（checklist）

对当前模块划分逐项检查：

| 维度                 | 检查要点                                                                              |
| -------------------- | ------------------------------------------------------------------------------------- |
| **单一职责**         | 每个模块是否只有一个清晰的主责；若存在多责，是否已在报告中说明且可接受                |
| **边界清晰**         | 模块间依赖是否与目录/构建 target 一致；是否存在「说不清属于哪一模块」的目录或文件     |
| **粒度一致**         | 是否有的模块过大（应考虑再拆）、有的过碎（应考虑合并）；与复杂度评级是否匹配          |
| **循环依赖**         | 是否存在未预期的循环依赖；若有，是否已标注并考虑通过重新划分模块消除                  |
| **与 Phase 01 一致** | 主流程、输入输出是否与当前模块划分一致；Phase 02 是否发现了应在概览中补充的模块或流程 |

**结论**：全部满足 → **通过**；任一项不满足 → **不通过**。

---

## 结论与变更列表

- **通过**：无需调整，进入 [Workflow](1-code-cognition/Workflow.md) 决策树 Q3。
- **不通过**：必须产出 **本轮变更列表**，例如：
  - 模块 A 拆为 A1、A2
  - 模块 B 与 C 合并为 B
  - 模块 D 重命名为 D_core

变更列表可记录于 `docs/codearch/decomposition_changelog.md`（可选），或直接写入当轮执行记录，便于判断收敛。

---

## 回退规则

根据变更类型决定回到哪一阶段：

| 情况                                 | 回退目标                        | 说明                                                     |
| ------------------------------------ | ------------------------------- | -------------------------------------------------------- |
| 仅模块边界/数量调整                  | 只重做 **Phase 02**             | 主流程与顶层认知不变；更新模块列表与受影响的模块报告即可 |
| 主流程、输入输出或顶层分解思路需修正 | 先 **Phase 01** 再 **Phase 02** | 先更新概览与顶层分解，再重新执行模块分析                 |

---

## 收敛条件

满足以下任一即视为 **已收敛**，可进入 Q3，不再强制迭代：

1. **本轮变更列表为空**：审视结论为「通过」，或修正后再次审视通过。
2. **迭代轮数达到上限**：建议上限 2–3 轮；达到后视为稳定，进入 Q3，可在报告中注明「分解已按上限收敛，后续可人工复核」。

---

## 下一步

- 审视通过或已收敛 → 返回 [Workflow](1-code-cognition/Workflow.md) 执行 Q3。
- 审视不通过 → 按上表回退到 [Phase 01](1-code-cognition/phases/01-overview.md) 或 [Phase 02](1-code-cognition/phases/02-modules.md)，执行变更列表后再次运行 Phase 02 并重新审视。
