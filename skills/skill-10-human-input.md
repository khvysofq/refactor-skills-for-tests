# Skill 10: 人工介入最小化问询

> **触发条件**：Skill 04 评估结果为 S4，或 Skill 09 无法判定  
> **目标**：把"必须问人"的点压缩到最少，结构化提问以一次问清

---

## 输入

- 触发问询的上下文（评估结果/行为差异）
- 相关代码和行为证据

---

## 输出

| 产出 | 路径 | 必须 |
|------|------|------|
| 结构化问题集 | 直接展示给用户 | ✓ |
| 答案记录 | `docs/decisions/<module>_clarifications.md` | ✓ |

---

## 核心原则

### 最小化问询原则

1. 只问必须问的问题
2. 一次问清，避免来回
3. 提供足够上下文让用户能快速回答
4. 问题可直接转化为测试用例或文档

### 问题质量标准

| 好问题特征 | 坏问题特征 |
|------------|------------|
| 有具体的代码/行为引用 | 太宽泛（"这个模块是干什么的"） |
| 有明确的选项（A/B/C） | 无上下文（"这里应该返回什么"） |
| 说明了判断错误的风险 | 需要用户大量调研才能回答 |
| 用户可以快速回答（<5分钟） | - |

---

## 核心任务

### 任务 1: 归类不确定点

**不确定点分类**：

| 类别 | 示例 | 处理优先级 |
|------|------|------------|
| 输入输出契约 | 边界值应该返回什么 | 高 |
| 错误处理语义 | 异常应该抛出还是返回错误码 | 高 |
| 业务规则 | 特定条件下的行为 | 高 |
| 性能要求 | 超时阈值、并发数 | 中 |
| 兼容性要求 | 旧版本数据格式支持 | 中 |
| 代码意图 | 某段"奇怪"代码的目的 | 低 |

### 任务 2: 构建问题集

**问题模板**：

```markdown
## 问题 N: <简短描述>

### 上下文
<相关代码片段>
```cpp
// 代码位置: path/to/file.cpp:line
<代码>
```

### 当前行为
<描述当前代码的行为>

### 不确定点
<具体不确定的是什么>

### 选项
**A**: <选项A描述>
- 理由: <为什么可能选A>
- 影响: <选A的后果>

**B**: <选项B描述>
- 理由: <为什么可能选B>
- 影响: <选B的后果>

### 风险评估
如果选错：<错误判断会导致的问题>

### 您的选择
[ ] A
[ ] B
[ ] 其他: ________________
```

### 任务 3: 整合问题集

**问题集格式**：

```markdown
# 模块 <module> 问询清单

> 生成日期: YYYY-MM-DD
> 问题数量: N
> 预计回答时间: X 分钟

## 背景

我们正在为 <module> 模块建立测试体系。在分析过程中遇到以下不确定点，需要您的判断。

请直接在 [ ] 中标记您的选择，或在"其他"处填写补充说明。

---

## 问题 1: <标题>
（问题内容）

---

## 问题 2: <标题>
（问题内容）

---

## 提交方式

回答完成后：
1. 直接回复此消息
2. 或更新到 docs/decisions/<module>_clarifications.md
```

### 任务 4: 记录答案

**答案记录模板**：

```markdown
# <module> 业务澄清记录

> 日期: YYYY-MM-DD
> 回答者: <name/role>

## 问题 1: <标题>

**问题**: <问题描述>

**答案**: <选项> - <补充说明>

**转化**:
- 测试用例: `test_xxx_when_yyy_then_zzz`
- 文档更新: 在 xxx.md 添加说明

---

## 问题 2: <标题>
...
```

---

## 问题设计示例

### 示例 1: 边界条件

```markdown
## 问题: 空字符串输入行为

### 上下文
```cpp
// src/parser.cpp:45
std::string parse(const std::string& input) {
    if (input.empty()) {
        return "";  // 或者应该抛异常？
    }
    // ...
}
```

### 当前行为
传入空字符串时，返回空字符串。

### 不确定点
空字符串是否是合法输入？

### 选项
**A**: 空字符串是合法输入，返回空结果
- 理由: 宽松处理，不报错
- 影响: 测试覆盖这个场景为正常路径

**B**: 空字符串是非法输入，应该报错
- 理由: 严格处理，尽早失败
- 影响: 测试覆盖这个场景为错误路径，考虑添加输入校验

### 风险评估
如果选错：可能导致上游错误被静默忽略，或正常调用报错
```

### 示例 2: 行为差异

```markdown
## 问题: 超时后重试行为

### 上下文
```cpp
// src/client.cpp:120
Response Client::request(const Request& req) {
    for (int i = 0; i < 3; i++) {  // 重试3次
        auto resp = doRequest(req);
        if (resp.ok()) return resp;
        sleep(1);  // 等1秒
    }
    return ErrorResponse("timeout");
}
```

### 当前行为
请求失败时重试3次，每次间隔1秒。

### 不确定点
这个重试逻辑是设计需求还是临时补丁？

### 选项
**A**: 重试是设计需求
- 理由: 处理临时网络问题
- 影响: 测试需要验证重试逻辑

**B**: 重试是临时补丁，应该可配置
- 理由: 让调用者控制重试策略
- 影响: 需要重构为可配置，测试不同配置

**C**: 不应该有重试，应该删除
- 理由: 重试应该在更上层处理
- 影响: 删除此逻辑，简化测试

### 风险评估
如果选错：可能保留不应该的逻辑，或删除必要的容错
```

---

## 验收标准

### 必须满足

- [ ] 问题数量 ≤ 5（如果更多，分批）
- [ ] 每个问题有明确选项
- [ ] 每个问题有上下文代码
- [ ] 收到答案并记录

### 验收检查

```bash
# 检查记录文件
[ -f "docs/decisions/<module>_clarifications.md" ] && echo "PASS" || echo "FAIL"
```

---

## 应该做

- ✓ 提供具体代码引用
- ✓ 给出明确选项而非开放问题
- ✓ 说明风险帮助用户判断
- ✓ 批量问询减少打扰

## 不应该做

- ✗ 问太多问题（>5个需分批）
- ✗ 问没有选项的开放问题
- ✗ 问不影响测试的问题
- ✗ 反复来回确认

---

## 状态跳转

收到答案后，根据触发来源返回：

| 触发来源 | 处理方式 | 返回目标 |
|----------|----------|----------|
| Skill 04（评估） | 根据答案重新评估状态 | [Skill 04](skill-04-assessment.md) |
| Skill 09（行为差异） | 根据答案执行处置 | [Skill 09](skill-09-behavior-drift.md) |

---

## 时间预估

| 活动 | 预估时间 |
|------|----------|
| 构建问题集 | 30 - 60 分钟 |
| 等待回答 | 取决于用户 |
| 记录并处理 | 15 - 30 分钟 |

---

**完成后**：根据触发来源返回对应 Skill
